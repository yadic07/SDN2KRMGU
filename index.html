<!DOCTYPE html>
<html lang="id" data-theme="system">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>SD Negeri 2 Karangmangu — Sekolah Unggul, Berkarakter</title>
  <meta name="description" content="Website resmi SD Negeri 2 Karangmangu. PPDB, pengumuman, kalender akademik, berita, galeri, e-learning, dan layanan sekolah." />
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="logosekolah.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" />
  <!-- Papa Parse untuk CSV -->
  <script defer src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    :root{
      --brand: #0E6FFF; --brand-2:#00B894; --accent:#FFE27A;
      --ink:#0F172A; --muted:#64748B; --bg:#F8FAFC; --card:#FFFFFF; --line:#E2E8F0;
      --radius:14px; --shadow:0 8px 28px rgba(2,6,23,.08); --shadow-sm:0 4px 14px rgba(2,6,23,.06);
      --s-1:.25rem; --s-2:.5rem; --s-3:.75rem; --s-4:1rem; --s-5:1.25rem; --s-6:1.5rem; --s-7:2rem;
      --h1:clamp(1.9rem,1.1rem + 2.6vw,3rem); --h2:clamp(1.35rem,1rem + 1.2vw,2rem); --p:clamp(.98rem,.95rem + .2vw,1.05rem);
      --nav-h:66px;
    }
    @media (prefers-color-scheme: dark){
      :root{ --ink:#E5E7EB; --muted:#A3AAB8; --bg:#0B1220; --card:#0F1629; --line:#1F2937; --shadow:0 8px 28px rgba(0,0,0,.45); --shadow-sm:0 4px 14px rgba(0,0,0,.35); }
    }
    html[data-theme="light"]{color-scheme:light}
    html[data-theme="dark"]{color-scheme:dark}
    *{box-sizing:border-box} html,body{margin:0;padding:0}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink);font-size:var(--p)}
    img{max-width:100%;display:block} a{color:inherit;text-decoration:none}
    :focus-visible{outline:2px solid var(--brand);outline-offset:2px} ::selection{background:rgba(14,111,255,.2)}
    .container{width:min(1180px,92%);margin-inline:auto} .grid{display:grid;gap:var(--s-6)}
    .card{background:var(--card);border:1px solid var(--line);box-shadow:var(--shadow-sm);border-radius:var(--radius);padding:var(--s-6)}
    .section{padding:64px 0} .lead{color:var(--muted)}
    .btn{display:inline-flex;align-items:center;gap:.6rem;padding:.85rem 1.05rem;border-radius:12px;font-weight:600;border:1px solid transparent;cursor:pointer;transition:.2s}
    .btn-primary{background:var(--brand);color:#fff} .btn-primary:hover{filter:brightness(.95);transform:translateY(-1px)}
    .btn-outline{border-color:var(--line);background:transparent} .btn-outline:hover{background:rgba(148,163,184,.12)}
    .chip{display:inline-flex;gap:.4rem;align-items:center;padding:.35rem .6rem;border-radius:999px;background:#E6F2FF;color:#0B5BD3;font-size:.83rem}
    .hidden{display:none !important} .wrap{display:flex;justify-content:space-between;align-items:center;gap:var(--s-6)}
    .progress{position:fixed;top:0;left:0;height:3px;background:linear-gradient(90deg,var(--brand),var(--brand-2));width:0%;z-index:100}
    .skip-link{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
    .skip-link:focus{position:fixed;left:1rem;top:1rem;width:auto;height:auto;background:#fff;color:#111;padding:.6rem 1rem;border-radius:10px;z-index:110}

    .topbar{background:#0B1220;color:#E5E7EB;font-size:.92rem}
    .topbar .container{padding:.55rem 0} .topbar a{color:#E5E7EB;opacity:.9}
    .topbar .social a{margin-left:.75rem;opacity:.85} .topbar .social a:hover{opacity:1}

    header{
      position:sticky;top:0;z-index:90;
      background: rgba(255,255,255,.9); /* fallback */
      background: color-mix(in oklab, var(--card) 90%, transparent);
      backdrop-filter:saturate(180%) blur(12px);
      border-bottom:1px solid var(--line)
    }
    nav.nav{height:var(--nav-h);display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:.8rem}
    .brand img{width:46px;height:46px;object-fit:contain;border-radius:10px}
    .brand .title{display:flex;line-height:1.05}
    .brand .title b{font-size:1.05rem} .brand .title span{font-size:.85rem;color:var(--muted)}
    .menu{display:flex;gap:.4rem;align-items:center}
    .menu a{padding:.55rem .8rem;border-radius:10px}
    .menu a[aria-current="true"]{background:rgba(14,111,255,.1);color:var(--brand);font-weight:700}
    .hamburger{display:none}
    .theme{display:inline-flex;gap:.35rem;align-items:center}
    .theme button{padding:.45rem .6rem;border-radius:10px;border:1px solid var(--line);background:transparent}
    .theme button[aria-pressed="true"]{background:rgba(14,111,255,.12);border-color:var(--brand);color:var(--brand)}

    .hero{border-bottom:1px solid var(--line)}
    .hero .wrap{display:grid;grid-template-columns:1.15fr .85fr;gap:var(--s-7);align-items:center;padding:34px 0}
    .hero h1{font-size:var(--h1);margin:0 0 .6rem}
    .hero .media{position:relative;aspect-ratio:16/10;border-radius:22px;overflow:hidden;box-shadow:var(--shadow)}
    .hero .media img{width:100%;height:100%;object-fit:cover}
    .hero .floating{
      position:absolute;inset:auto auto 14px 14px;
      background: rgba(255,255,255,.92); /* fallback */
      background: color-mix(in oklab, var(--card) 92%, transparent);
      padding:.6rem .8rem;border-radius:12px;display:flex;gap:.6rem;align-items:center;border:1px solid var(--line);box-shadow:var(--shadow-sm)
    }
    /* === HERO MEDIA UPGRADE === */
.media.media-hero{position:relative;aspect-ratio:16/9;border-radius:22px;overflow:hidden;box-shadow:var(--shadow)}
.hero-carousel{height:100%;display:flex;width:300%;transform:translateX(0%);transition:transform .8s ease-in-out}
.hero-slide{flex:0 0 100%;height:100%;position:relative}
.hero-slide img{width:100%;height:100%;object-fit:cover}
.hero-overlay{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:space-between;padding:14px;background:linear-gradient(to top, rgba(0,0,0,.35), rgba(0,0,0,0) 50%)}
.agenda-chip{align-self:flex-start;display:inline-flex;gap:.5rem;align-items:center;background:rgba(0,0,0,.55);color:#fff;padding:.45rem .7rem;border-radius:12px;font-size:.92rem;backdrop-filter:blur(6px)}
.quick-actions{display:flex;gap:.5rem;flex-wrap:wrap}
.quick-actions .btn{backdrop-filter:blur(6px)}
.quick-actions .btn-outline{background:rgba(255,255,255,.14);border-color:rgba(255,255,255,.35);color:#fff}
.quick-actions .btn-primary{background:var(--brand);color:#fff}
.hero-dots{position:absolute;left:50%;transform:translateX(-50%);bottom:10px;display:flex;gap:.35rem}
.hero-dots button{width:8px;height:8px;border-radius:50%;border:0;background:rgba(255,255,255,.5);cursor:pointer}
.hero-dots button[aria-current="true"]{background:#fff;width:22px;border-radius:999px}
.hero-controls{position:absolute;inset:auto 0 50% 0;display:flex;justify-content:space-between;padding:0 8px;transform:translateY(50%)}
.hero-controls button{width:40px;height:40px;border-radius:50%;border:1px solid rgba(255,255,255,.5);background:rgba(0,0,0,.35);color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer}
@media (max-width:720px){.quick-actions .btn{padding:.6rem .75rem}}

    .stats{display:grid;grid-template-columns:repeat(4,1fr);gap:var(--s-4);margin-top:var(--s-5)}
    .stat{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:1rem;text-align:center;box-shadow:var(--shadow-sm)}
    .stat b{display:block;font-size:1.25rem}

    .ticker{
      display:flex;gap:.8rem;align-items:center;
      border:1px dashed var(--line); /* fallback */
      border:1px dashed color-mix(in oklab, var(--brand) 50%, var(--line));
      background: rgba(14,111,255,.06); /* fallback */
      background: color-mix(in oklab, var(--brand) 6%, transparent);
      color:inherit;border-radius:12px;padding:.6rem .8rem;overflow:hidden
    }
    .ticker .items{display:flex;gap:2rem;white-space:nowrap;animation:scroll 22s linear infinite}
    .ticker:hover .items{animation-play-state:paused}
    @keyframes scroll{to{transform:translateX(-50%)}}

    .layout{display:grid;grid-template-columns:2fr 1fr;gap:var(--s-6)}
    .filters{display:flex;gap:.6rem;flex-wrap:wrap;margin:.4rem 0 1rem}
    .news-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:var(--s-6)}
    .news .thumb{aspect-ratio:16/9;overflow:hidden;border-radius:12px;margin-bottom:.8rem}
    .news .thumb img{width:100%;height:100%;object-fit:cover;transition:transform .5s}
    .news article:hover .thumb img{transform:scale(1.05)}
    .sidebar .list{display:grid;gap:.75rem}
    .sidebar .list a{display:flex;gap:.8rem;align-items:center;padding:.7rem;border-radius:12px;background:var(--card);border:1px solid var(--line);box-shadow:var(--shadow-sm)}

    .events .item{display:flex;gap:.9rem;align-items:center;background:var(--card);border:1px solid var(--line);border-radius:12px;padding:.9rem;box-shadow:var(--shadow-sm)}
    .date-badge{min-width:66px;text-align:center;background:var(--brand);color:#fff;border-radius:10px;padding:.5rem .6rem}
    .date-badge b{display:block;font-size:1.2rem}

    .teachers{scroll-snap-type:x mandatory;display:flex;gap:1rem;overflow:auto;padding-bottom:.4rem}
    .teachers::-webkit-scrollbar{height:8px}
    .teachers::-webkit-scrollbar-thumb{background:rgba(0,0,0,.14);border-radius:999px}
    .teacher{scroll-snap-align:start;min-width:190px;background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow-sm);padding:.9rem;text-align:center}
    .teacher img{width:110px;height:140px;object-fit:cover;border-radius:10px;margin-inline:auto;border:2px solid var(--line)}

    .gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:.8rem}
    .gallery .pic{aspect-ratio:4/3;overflow:hidden;border-radius:12px}
    .gallery .pic img{width:100%;height:100%;object-fit:cover;transition:transform .6s}
    .gallery .pic:hover img{transform:scale(1.04)}

    .downloads .row{display:flex;justify-content:space-between;align-items:center;background:var(--card);border:1px solid var(--line);border-radius:12px;padding:.8rem 1rem;box-shadow:var(--shadow-sm)}
    .downloads .row span{display:flex;align-items:center;gap:.7rem}

    .contact{display:grid;grid-template-columns:1.1fr .9fr;gap:var(--s-6)}
    form .field{display:flex;flex-direction:column;gap:.4rem;margin-bottom:.8rem}
    input,textarea,select{padding:.8rem;border:1px solid var(--line);border-radius:12px;background:var(--card);color:inherit}
    textarea{min-height:120px;resize:vertical}

    footer{background:#0B1220;color:#cbd5e1;margin-top:48px}
    footer .cols{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:var(--s-6);padding:40px 0}
    footer a{color:#e2e8f0cc}
    .copyright{border-top:1px solid #1F2937;padding:14px 0;color:#9CA3AF;font-size:.95rem;text-align:center}

    .fab{position:fixed;right:18px;bottom:18px;background:#25D366;color:#fff;width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow);z-index:80}
    .to-top{position:fixed;right:18px;bottom:88px;opacity:0;pointer-events:none;transition:.2s;background:var(--brand);color:#fff;width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow);z-index:80}
    .to-top.show{opacity:1;pointer-events:auto}

    /* Modal dialog */
    dialog{border:none;border-radius:16px;box-shadow:var(--shadow);padding:0;width:min(900px,95%);max-height:85vh}
    dialog::backdrop{background:rgba(0,0,0,.5)}
    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid var(--line);background:var(--card)}
    .modal-body{padding:0;background:var(--card)}
    .modal-body iframe{display:block;border:0;width:100%;height:70vh}

    @media (max-width:1024px){
      .hero .wrap{grid-template-columns:1fr}
      .layout{grid-template-columns:1fr}
      .news-grid{grid-template-columns:1fr 1fr}
      .contact{grid-template-columns:1fr}
      footer .cols{grid-template-columns:1.4fr 1fr 1fr}
    }
    @media (max-width:720px){
      .menu{display:none}
      .hamburger{display:inline-flex}
      .menu.mobile{display:grid;gap:.4rem;padding:.6rem;background:var(--card);border:1px solid var(--line);border-radius:12px;position:absolute;right:4%;top:calc(var(--nav-h) + .5rem);min-width:240px;box-shadow:var(--shadow)}
      .stats{grid-template-columns:repeat(2,1fr)}
      .news-grid{grid-template-columns:1fr}
      .gallery{grid-template-columns:1fr 1fr}
      footer .cols{grid-template-columns:1fr 1fr}
    }
    @media (prefers-reduced-motion: reduce){
      .ticker .items{animation: none}
      .news .thumb img{transition:none}
    }
    /* DEFAULT (kompatibel luas) */
.menu.mobile{
  position: fixed;
  top: var(--nav-h);
  right: 0;
  left: 0;
  /* Fallback tinggi menu: vh biasa (paling kompatibel) */
  height: calc(100vh - var(--nav-h));

  /* Safe area fallback dulu */
  padding-bottom: 12px;

  overflow: auto;
  background: var(--card);
  padding: .8rem;
  gap: .4rem;
  border-radius: 0;
  border: 0;
  box-shadow: var(--shadow);
}

/* Safari “small viewport” (svh) bila tersedia */
@supports (height: 100svh) {
  .menu.mobile{
    height: calc(100svh - var(--nav-h));
  }
}

/* Viewport dinamis modern (dvh) bila tersedia — dipisah agar VS Code tidak merah */
@supports (height: 100dvh) {
  .menu.mobile{
    height: calc(100dvh - var(--nav-h));
  }
}

/* Safe-area notch iPhone tanpa argumen fallback (lebih diterima lint) */
@supports (padding-bottom: calc(env(safe-area-inset-bottom) + 12px)) {
  .menu.mobile{
    padding-bottom: calc(env(safe-area-inset-bottom) + 12px);
  }
}

  </style>
</head>
<body>
  <div class="progress" id="progress"></div>
  <a class="skip-link" href="#main">Lewati ke konten utama</a>

  <div class="topbar" role="region" aria-label="Kontak singkat">
    <div class="container wrap">
      <div>
        <i class="fa-solid fa-envelope"></i>
        <a href="mailto:sdn2krmgu@gmail.com">sdn2krmgu@gmail.com</a>
        &nbsp;&nbsp;|&nbsp;&nbsp;
        <i class="fa-solid fa-phone"></i>
        <a href="tel:+628812071728">0881-2071-728</a>
      </div>
      <div class="wrap" style="gap:.75rem">
        <div class="theme" role="group" aria-label="Pengaturan tema">
          <button id="thLight" type="button" aria-pressed="false" title="Tema Terang"><i class="fa-regular fa-sun"></i></button>
          <button id="thDark"  type="button" aria-pressed="false" title="Tema Gelap"><i class="fa-regular fa-moon"></i></button>
          <button id="thSystem"type="button" aria-pressed="true"  title="Ikuti Sistem"><i class="fa-solid fa-circle-half-stroke"></i></button>
        </div>
        <div class="social" aria-label="Media sosial">
          <a aria-label="Facebook" href="#"><i class="fa-brands fa-facebook"></i></a>
          <a aria-label="Instagram" href="#"><i class="fa-brands fa-instagram"></i></a>
          <a aria-label="YouTube" href="#"><i class="fa-brands fa-youtube"></i></a>
        </div>
      </div>
    </div>
  </div>

  <header>
    <div class="container">
      <nav class="nav" aria-label="Menu utama">
        <a class="brand" href="#">
          <img src="logosekolah.png" alt="Logo SD Negeri 2 Karangmangu" />
          <span class="title">
            <b>SD Negeri 2 Karangmangu</b>
            <span>Unggul • Berkarakter • Berprestasi</span>
          </span>
        </a>
        <div class="menu" id="deskMenu">
          <a href="#beranda">Beranda</a>
          <a href="#ppdb">PPDB</a>
          <a href="#pengumuman">Pengumuman</a>
          <a href="#berita">Berita</a>
          <a href="#kalender">Kalender</a>
          <a href="#galeri">Galeri</a>
          <a href="#kontak">Kontak</a>
          <a class="btn btn-outline" href="#elearning"><i class="fa-solid fa-graduation-cap"></i> E-Learning</a>
        </div>
        <button class="hamburger btn btn-outline" id="hamburger" aria-label="Buka menu">
          <i class="fa-solid fa-bars"></i>
        </button>
      </nav>
    </div>
    <div class="container">
      <div id="mobileMenu" class="menu mobile hidden" aria-label="Menu seluler">
        <a href="#beranda">Beranda</a>
        <a href="#ppdb">PPDB</a>
        <a href="#pengumuman">Pengumuman</a>
        <a href="#berita">Berita</a>
        <a href="#kalender">Kalender</a>
        <a href="#galeri">Galeri</a>
        <a href="#kontak">Kontak</a>
        <a class="btn btn-outline" href="#elearning"><i class="fa-solid fa-graduation-cap"></i> E-Learning</a>
      </div>
    </div>
  </header>

  <main id="main">
    <section id="beranda" class="hero" aria-label="Beranda">
      <div class="container wrap">
        <div>
          <span class="chip"><i class="fa-solid fa-school"></i> Sekolah Ramah Anak</span>
          <h1>Belajar Nyaman, Prestasi Gemilang</h1>
          <p class="lead">Platform resmi sekolah: PPDB, pengumuman, kalender, berita, galeri, dan layanan digital terintegrasi.</p>
          <div style="display:flex;gap:.6rem;margin-top:.9rem;flex-wrap:wrap">
            <!-- OPEN MODAL PPDB -->
            <button class="btn btn-primary" id="openPPDB"><i class="fa-solid fa-file-circle-check"></i> Daftar PPDB</button>
            <a class="btn btn-outline" href="#downloads"><i class="fa-solid fa-download"></i> Unduh Berkas</a>
          </div>
          <div class="stats">
            <div class="stat"><b id="siswaCount">4</b><span class="lead">Siswa</span></div>
            <div class="stat"><b>13</b><span class="lead">Guru & Tendik</span></div>
            <div class="stat"><b>6</b><span class="lead">Rombel</span></div>
            <div class="stat"><b>B</b><span class="lead">Akreditasi</span></div>
          </div>
        </div>
        <div class="media">
          <img src="IMG_5003.jpg" alt="Suasana belajar di SD Negeri 2 Karangmangu" loading="eager" />
          <div class="floating"><i class="fa-solid fa-bell"></i> Info terbaru di bawah</div>
        </div>
      </div>
    </section>

    <section id="pengumuman" class="section" aria-label="Pengumuman">
      <div class="container">
        <h2>Pengumuman</h2>
        <p class="lead">Informasi penting terkait kegiatan sekolah.</p>
        <div class="ticker card" aria-live="polite">
          <div class="items" id="tickerItems">
            <span>PPDB Gelombang 2 dibuka s.d. 30 Agustus — <a class="chip" href="#ppdb">Daftar sekarang</a></span>
            <span>Penerimaan Rapor Tengah Semester: 10 September</span>
            <span>Vaksinasi siswa kelas 1–3: 18 September</span>
            <span>Lomba Kebersihan Kelas — setiap Jumat pekan ke-2</span>
          </div>
        </div>
      </div>
    </section>

    <section id="berita" class="section" aria-label="Berita">
      <div class="container layout">
        <div class="news">
          <h2>Berita Terbaru</h2>
          <p class="lead">Kabar kegiatan dan prestasi warga sekolah.</p>
          <div class="filters">
            <input id="searchNews" type="search" placeholder="Cari berita…" aria-label="Cari berita" />
            <button class="btn btn-outline" data-filter="all">Semua</button>
            <button class="btn btn-outline" data-filter="prestasi">Prestasi</button>
            <button class="btn btn-outline" data-filter="kegiatan">Kegiatan</button>
            <button class="btn btn-outline" data-filter="pengumuman">Pengumuman</button>
          </div>
          <div class="news-grid" id="newsGrid">
            <article class="card" data-tags="kegiatan">
              <div class="thumb"><img src="IMG_5124.jpg" alt="Kegiatan perpisahan kelas VI" loading="lazy" /></div>
              <h3>Acara Perpisahan Kelas VI</h3>
              <p class="lead">Kebersamaan dan persembahan siswa kelas VI menutup tahun ajaran dengan haru dan bangga.</p>
              <div class="lead" style="display:flex;gap:.6rem;flex-wrap:wrap"><span class="chip"><i class="fa-regular fa-calendar"></i> 25 Mei</span><span class="chip"><i class="fa-solid fa-tag"></i> Kegiatan</span></div>
            </article>
            <article class="card" data-tags="kegiatan fasilitas">
              <div class="thumb"><img src="IMG_5127.jpg" alt="Peningkatan fasilitas sekolah" loading="lazy" /></div>
              <h3>Peningkatan Fasilitas Sekolah</h3>
              <p class="lead">Penambahan ruang literasi, pengecatan kelas, serta pojok konseling siswa.</p>
              <div class="lead" style="display:flex;gap:.6rem;flex-wrap:wrap"><span class="chip"><i class="fa-regular fa-calendar"></i> 02 Juni</span><span class="chip"><i class="fa-solid fa-tag"></i> Kegiatan</span></div>
            </article>
            <article class="card" data-tags="pengumuman">
              <div class="thumb"><img src="IMG_5003.jpg" alt="Ujian Akhir Sekolah" loading="lazy" /></div>
              <h3>Jadwal Ujian Akhir</h3>
              <p class="lead">UAS dilaksanakan 17–21 Juni. Siapkan kartu peserta dan identitas diri.</p>
              <div class="lead" style="display:flex;gap:.6rem;flex-wrap:wrap"><span class="chip"><i class="fa-regular fa-calendar"></i> 10 Juni</span><span class="chip"><i class="fa-solid fa-tag"></i> Pengumuman</span></div>
            </article>
            <article class="card" data-tags="prestasi">
              <div class="thumb"><img src="https://images.unsplash.com/photo-1600585152220-90363fe7e115?q=80&w=1200&auto=format&fit=crop" alt="Prestasi lomba matematika" loading="lazy" /></div>
              <h3>Juara 1 Olimpiade Matematika</h3>
              <p class="lead">Ananda Dwi meraih juara 1 tingkat kabupaten. Selamat!</p>
              <div class="lead" style="display:flex;gap:.6rem;flex-wrap:wrap"><span class="chip"><i class="fa-regular fa-calendar"></i> 28 Juli</span><span class="chip"><i class="fa-solid fa-tag"></i> Prestasi</span></div>
            </article>
          </div>
        </div>

        <aside class="sidebar">
          <div class="card">
            <h3>Layanan Cepat</h3>
            <div class="list" style="margin-top:.6rem">
              <a href="#ppdb"><i class="fa-solid fa-user-plus"></i> PPDB Online</a>
              <a href="#elearning"><i class="fa-solid fa-graduation-cap"></i> E-Learning</a>
              <a href="#downloads"><i class="fa-solid fa-file-arrow-down"></i> Unduhan Formulir</a>
              <a href="#kontak"><i class="fa-solid fa-headset"></i> Hubungi Sekolah</a>
            </div>
          </div>

          <div class="card">
            <h3>Agenda Terdekat</h3>
            <div class="list" id="agendaList" style="margin-top:.6rem"></div>
          </div>
        </aside>
      </div>
    </section>

    <section id="kalender" class="section" aria-label="Kalender Akademik & Kegiatan">
      <div class="container">
        <h2>Kalender Akademik & Kegiatan</h2>
        <p class="lead">Jadwal penting selama tahun ajaran berjalan.</p>

        <div class="filters" style="align-items:center">
          <select id="filterMonth" aria-label="Filter bulan">
            <option value="all">Semua Bulan</option>
            <option value="7">Juli</option><option value="8">Agustus</option>
            <option value="9">September</option><option value="10">Oktober</option>
            <option value="11">November</option><option value="12">Desember</option>
          </select>
          <select id="filterType" aria-label="Filter jenis">
            <option value="all">Semua Jenis</option>
            <option value="ujian">Ujian</option><option value="rapor">Rapor</option>
            <option value="libur">Libur</option><option value="kegiatan">Kegiatan</option>
          </select>

          <!-- Sinkron dari Google Sheet + Import CSV -->
          <button class="btn btn-outline" id="syncSheet"><i class="fa-solid fa-rotate"></i> Sinkronkan Kalender</button>
          <label class="btn btn-outline" for="csvInput"><i class="fa-solid fa-file-import"></i> Impor CSV</label>
          <input id="csvInput" type="file" accept=".csv" hidden />
          <span id="lastSync" class="lead" style="margin-left:.4rem"></span>
        </div>

        <div class="grid" id="eventsList"></div>
      </div>
    </section>

    <section id="ppdb" class="section" style="background:rgba(224,242,254,.35);border-block:1px solid var(--line)" aria-label="PPDB">
      <div class="container grid" style="grid-template-columns:1.2fr .8fr;align-items:center">
        <div>
          <h2>Penerimaan Peserta Didik Baru (PPDB)</h2>
          <p class="lead">Daftar mudah, cepat, dan transparan. Siapkan dokumen: KK, Akta Kelahiran, KTP Orang Tua, dan ijazah TK (bila ada).</p>
          <ol class="lead" style="padding-left:1rem">
            <li>Isi formulir pendaftaran online.</li>
            <li>Unggah dokumen pendukung.</li>
            <li>Cek hasil verifikasi pada dashboard.</li>
            <li>Finalisasi berkas di sekolah.</li>
          </ol>
          <div style="display:flex;gap:.6rem;margin-top:.8rem;flex-wrap:wrap">
            <button class="btn btn-primary" id="openPPDB2" aria-label="Daftar PPDB">Daftar PPDB</button>
            <a class="btn btn-outline" href="#downloads"><i class="fa-solid fa-file-pdf"></i> Panduan PPDB (PDF)</a>
          </div>
        </div>
        <div class="card">
          <h3>Jadwal PPDB</h3>
          <ul class="lead" style="line-height:1.9;margin:0;padding-left:1rem">
            <li>Pendaftaran: 1–30 Agustus</li>
            <li>Verifikasi: 1–31 Agustus</li>
            <li>Pengumuman: 3 September</li>
            <li>Daftar Ulang: 4–6 September</li>
          </ul>
          <div class="chip" style="margin-top:.6rem"><i class="fa-solid fa-circle-info"></i> Kontak Panitia: 0881-2071-728</div>
        </div>
      </div>
    </section>

    <section class="section" aria-label="Kepala Sekolah">
      <div class="container grid" style="grid-template-columns:.9fr 1.1fr;align-items:center">
        <div class="card" style="text-align:center">
          <img src="uus.jpg" alt="Kepala Sekolah SD Negeri 2 Karangmangu" style="width:220px;height:280px;object-fit:cover;border-radius:16px;margin-inline:auto;border:2px solid var(--line)" loading="lazy" />
          <h3 style="margin:.7rem 0 .2rem">UUS SUSSANTO, S.Pd., M.Pd</h3>
          <p class="lead">Kepala Sekolah</p>
        </div>
        <div>
          <h2>Sambutan Kepala Sekolah</h2>
          <p class="lead">Selamat datang di laman resmi sekolah kami. Kami berkomitmen menghadirkan layanan pendidikan berkualitas dan lingkungan belajar yang aman, inklusif, serta menyenangkan.</p>
          <p class="lead">Mari bersama membangun karakter, literasi, dan numerasi siswa untuk masa depan yang gemilang.</p>
        </div>
      </div>
    </section>

    <section id="guru" class="section" aria-label="Guru & Tenaga Kependidikan">
      <div class="container">
        <h2>Guru & Tenaga Kependidikan</h2>
        <p class="lead">Profil singkat pendidik di SDN 2 Karangmangu.</p>
        <div class="teachers" id="teacherTrack" aria-label="Daftar guru (geser untuk melihat)">
          <div class="teacher">
            <img src="fotosaya.png" alt="Yadi Cahyadi, S.Pd" loading="lazy" />
            <h4>Yadi Cahyadi, S.Pd</h4>
            <p class="lead">Guru Kelas</p>
          </div>
          <div class="teacher">
            <img src="uussambas.jpeg" alt="Uus Sambas, S.Pd" loading="lazy" />
            <h4>Uus Sambas, S.Pd</h4>
            <p class="lead">Guru Olahraga</p>
          </div>
          <div class="teacher">
            <img src="guru3.jpg" alt="Yanti Sukmayanti, S.Pd" loading="lazy" />
            <h4>Yanti Sukmayanti, S.Pd</h4>
            <p class="lead">Guru Bahasa Indonesia</p>
          </div>
        </div>
      </div>
    </section>

    <section id="elearning" class="section" aria-label="Portal Pembelajaran">
      <div class="container">
        <h2>Portal Pembelajaran</h2>
        <p class="lead">Akses materi, tugas, dan evaluasi secara daring.</p>
        <div class="grid" style="grid-template-columns:repeat(3,1fr)">
          <a class="card" href="#" aria-label="Masuk Google Classroom">
            <h3><i class="fa-brands fa-google"></i> Google Classroom</h3>
            <p class="lead">Kelas daring untuk semua rombel.</p>
          </a>
          <a class="card" href="#" aria-label="Masuk Moodle">
            <h3><i class="fa-solid fa-graduation-cap"></i> Moodle</h3>
            <p class="lead">LMS untuk materi terstruktur.</p>
          </a>
          <a class="card" href="#" aria-label="Masuk Perpustakaan Digital">
            <h3><i class="fa-solid fa-book-open"></i> Perpustakaan Digital</h3>
            <p class="lead">Buku & referensi elektronik.</p>
          </a>
        </div>
      </div>
    </section>

    <section id="galeri" class="section" aria-label="Galeri Sekolah">
      <div class="container">
        <h2>Galeri Sekolah</h2>
        <p class="lead">Dokumentasi kegiatan siswa dan guru.</p>
        <div class="gallery">
          <div class="pic"><img src="IMG_5003.jpg" alt="Kegiatan upacara bendera" loading="lazy" /></div>
          <div class="pic"><img src="IMG_5124.jpg" alt="Kegiatan literasi di perpustakaan" loading="lazy" /></div>
          <div class="pic"><img src="IMG_5127.jpg" alt="Lomba kebersihan kelas" loading="lazy" /></div>
          <div class="pic"><img src="https://images.unsplash.com/photo-1517414204284-0b5716ca1387?q=80&w=1200&auto=format&fit=crop" alt="Ekstrakurikuler pramuka" loading="lazy" /></div>
          <div class="pic"><img src="https://images.unsplash.com/photo-1523246192258-9d85f38fb5d6?q=80&w=1200&auto=format&fit=crop" alt="Kegiatan sains" loading="lazy" /></div>
          <div class="pic"><img src="https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a?q=80&w=1200&auto=format&fit=crop" alt="Kegiatan seni" loading="lazy" /></div>
        </div>
      </div>
    </section>

    <section id="downloads" class="section" aria-label="Pusat Unduhan">
      <div class="container">
        <h2>Pusat Unduhan</h2>
        <p class="lead">Formulir dan dokumen resmi sekolah.</p>
        <div class="grid">
          <div class="downloads card">
            <div class="row"><span><i class="fa-regular fa-file-pdf"></i> Panduan PPDB</span><a class="btn btn-outline" href="#">Unduh</a></div>
            <div class="row"><span><i class="fa-regular fa-file-lines"></i> Formulir Pendaftaran</span><a class="btn btn-outline" href="#">Unduh</a></div>
            <div class="row"><span><i class="fa-regular fa-file-excel"></i> Jadwal Pelajaran</span><a class="btn btn-outline" href="#">Unduh</a></div>
            <div class="row"><span><i class="fa-regular fa-file-word"></i> Surat Izin Tidak Masuk</span><a class="btn btn-outline" href="#">Unduh</a></div>
          </div>
        </div>
      </div>
    </section>

    <section id="kontak" class="section" aria-label="Kontak & Lokasi">
      <div class="container contact">
        <div>
          <h2>Kontak & Lokasi</h2>
          <p class="lead">Silakan hubungi kami untuk informasi lebih lanjut.</p>
          <form onsubmit="event.preventDefault(); alert('Terima kasih! Pesan Anda telah terkirim.');" novalidate>
            <div class="field"><label for="nama">Nama</label><input id="nama" name="nama" required /></div>
            <div class="field"><label for="email">Email</label><input id="email" name="email" type="email" required /></div>
            <div class="field"><label for="pesan">Pesan</label><textarea id="pesan" name="pesan" required></textarea></div>
            <button class="btn btn-primary" type="submit"><i class="fa-solid fa-paper-plane"></i> Kirim</button>
          </form>
        </div>
        <div class="card">
          <h3>Alamat</h3>
          <p class="lead">SD Negeri 2 Karangmangu<br/>Karangmangu, (Isi alamat lengkap di sini)</p>
          <div style="border-radius:12px;overflow:hidden;margin-top:.6rem">
            <iframe title="Peta sekolah" src="https://www.google.com/maps?q=Karangmangu&output=embed" width="100%" height="280" style="border:0" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
          </div>
          <div style="display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.8rem">
            <a class="btn btn-outline" href="mailto:sdn2krmgu@gmail.com"><i class="fa-solid fa-envelope"></i> Email</a>
            <a class="btn btn-outline" href="tel:+628812071728"><i class="fa-solid fa-phone"></i> Telepon</a>
            <a class="btn btn-outline" href="https://wa.me/628812071728" target="_blank" rel="noopener"><i class="fa-brands fa-whatsapp"></i> WhatsApp</a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer role="contentinfo">
    <div class="container cols">
      <div>
        <div class="brand" style="margin-bottom:.6rem">
          <img src="logosdn2krmgu.png" alt="Logo" />
          <span class="title"><b>SD Negeri 2 Karangmangu</b><span>Unggul • Berkarakter • Berprestasi</span></span>
        </div>
        <p class="lead">Pusat informasi resmi dan layanan digital bagi siswa, orang tua, serta masyarakat.</p>
      </div>
      <div>
        <h4>Tautan</h4>
        <ul style="list-style:none;padding:0;line-height:2">
          <li><a href="#ppdb">PPDB</a></li><li><a href="#berita">Berita</a></li>
          <li><a href="#kalender">Kalender</a></li><li><a href="#downloads">Unduhan</a></li>
        </ul>
      </div>
      <div>
        <h4>Layanan</h4>
        <ul style="list-style:none;padding:0;line-height:2">
          <li><a href="#elearning">E-Learning</a></li><li><a href="#guru">Data Guru</a></li>
          <li><a href="#galeri">Galeri</a></li><li><a href="#kontak">Kontak</a></li>
        </ul>
      </div>
      <div>
        <h4>Jam Layanan</h4>
        <ul style="list-style:none;padding:0;line-height:2">
          <li>Senin–Jumat: 07.00–14.00</li>
          <li>Sabtu: 07.00–11.00</li>
          <li>Minggu/Tanggal Merah: Tutup</li>
        </ul>
      </div>
    </div>
    <div class="copyright">© <span id="year"></span> SD Negeri 2 Karangmangu. Dibuat dengan ❤️ untuk pendidikan.</div>
  </footer>

  <a class="fab" href="https://wa.me/628812071728" aria-label="Chat WhatsApp" target="_blank" rel="noopener">
    <i class="fa-brands fa-whatsapp" style="font-size:1.45rem"></i>
  </a>
  <button id="toTop" class="to-top" aria-label="Kembali ke atas"><i class="fa-solid fa-arrow-up"></i></button>

  <!-- MODAL PPDB -->
  <dialog id="ppdbDialog" aria-label="Formulir PPDB">
    <div class="modal-header">
      <strong>Formulir PPDB</strong>
      <div style="display:flex;gap:.5rem;align-items:center">
        <a id="ppdbOpenNew" class="btn btn-outline" target="_blank" rel="noopener"><i class="fa-solid fa-arrow-up-right-from-square"></i> Buka di Tab Baru</a>
        <button class="btn btn-primary" id="ppdbClose"><i class="fa-solid fa-xmark"></i> Tutup</button>
      </div>
    </div>
    <div class="modal-body">
      <iframe id="ppdbFrame" title="Formulir PPDB" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
  </dialog>

  <script>
    /* ========= CONFIG ========= */
    const PPDB_FORM_URL  = 'https://forms.gle/REPLACE_ME'; // <-- GANTI dgn link Google Form/SiPPDB
    const SHEET_CSV_URL  = 'https://docs.google.com/spreadsheets/d/KEY/export?format=csv&gid=0'; // <-- GANTI dgn link CSV "Publish to the web"
    const CSV_SCHEMA = { // header wajib (case-insensitive): title,date,type,place,desc
      date: 'YYYY-MM-DD', // format tanggal
    };

    /* ====== YEAR ====== */
    document.getElementById('year').textContent = new Date().getFullYear();

    /* ====== MOBILE MENU ====== */
    const hamburger = document.getElementById('hamburger');
    const mobileMenu = document.getElementById('mobileMenu');
    hamburger?.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
      hamburger.setAttribute('aria-expanded', String(!mobileMenu.classList.contains('hidden')));
    });
    mobileMenu?.querySelectorAll('a').forEach(a=>a.addEventListener('click',()=>mobileMenu.classList.add('hidden')));

    /* ====== SMOOTH SCROLL ====== */
    document.querySelectorAll('a[href^="#"]').forEach(a=>{
      a.addEventListener('click',e=>{
        const id=a.getAttribute('href');
        if(id && id.length>1){
          const el=document.querySelector(id);
          if(el){ e.preventDefault(); el.scrollIntoView({behavior:'smooth'}); }
        }
      });
    });

    /* ====== SCROLL PROGRESS + BACK TO TOP ====== */
    const progress = document.getElementById('progress');
    const toTop = document.getElementById('toTop');
    function onScroll(){
      const h = document.documentElement;
      const scrolled = (h.scrollTop) / (h.scrollHeight - h.clientHeight) * 100;
      progress.style.width = scrolled + '%';
      if (h.scrollTop > 600) toTop.classList.add('show'); else toTop.classList.remove('show');
    }
    window.addEventListener('scroll', onScroll, {passive:true});
    toTop.addEventListener('click', ()=>window.scrollTo({top:0,behavior:'smooth'}));

    /* ====== TICKER DUPLICATE ====== */
    (function(){ const wrap=document.getElementById('tickerItems'); if(!wrap) return; wrap.innerHTML += wrap.innerHTML; })();

    /* ====== NEWS: FILTER + SEARCH ====== */
    const newsGrid=document.getElementById('newsGrid');
    const buttons=document.querySelectorAll('[data-filter]');
    const search=document.getElementById('searchNews');

    function normalizeText(s){ return (s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,''); }
    function applyFilter(){
      const q=normalizeText(search.value);
      const active=document.querySelector('[data-filter].active')?.dataset.filter || 'all';
      newsGrid.querySelectorAll('article').forEach(card=>{
        const tags=normalizeText(card.dataset.tags);
        const text=normalizeText(card.innerText);
        const tagOk = active==='all' || tags.includes(active);
        const searchOk = !q || text.includes(q);
        card.style.display = (tagOk && searchOk)?'block':'none';
      });
    }
    buttons.forEach(btn=>{
      btn.addEventListener('click',()=>{ buttons.forEach(b=>b.classList.remove('active')); btn.classList.add('active'); applyFilter(); });
    });
    search?.addEventListener('input',applyFilter);

    /* ====== EVENTS (default + import Sheet/CSV) ====== */
    const eventsDefault=[
      {title:'PPDB Gelombang 2 Ditutup',date:'2025-08-30',type:'kegiatan',place:'Daring',desc:'Penutupan pendaftaran gelombang 2.'},
      {title:'Penerimaan Rapor Tengah Semester',date:'2025-09-10',type:'rapor',place:'Sekolah',desc:'Orang tua hadir ke wali kelas.'},
      {title:'Vaksinasi Kelas 1–3',date:'2025-09-18',type:'kegiatan',place:'UKS',desc:'Kerja sama Puskesmas.'},
      {title:'Ujian Akhir Semester',date:'2025-12-15',type:'ujian',place:'Kelas',desc:'UAS seluruh rombel.'},
      {title:'Libur Semester',date:'2025-12-23',type:'libur',place:'—',desc:'Libur akhir semester.'},
    ];
    let events=[...eventsDefault];

    const agendaList=document.getElementById('agendaList');
    const list=document.getElementById('eventsList');
    const selMonth=document.getElementById('filterMonth');
    const selType=document.getElementById('filterType');
    const lastSyncEl=document.getElementById('lastSync');
    const syncBtn=document.getElementById('syncSheet');
    const csvInput=document.getElementById('csvInput');

    function fmtDate(d,opts){ return new Date(d).toLocaleDateString('id-ID',opts); }
    function pad(n){ return String(n).padStart(2,'0'); }
    function toICS(ev){
      const dt  = new Date(ev.date+'T08:00:00'); // 08:00 lokal
      const end = new Date(dt.getTime()+2*60*60*1000);
      function toLocal(dateObj){
        const y=dateObj.getFullYear(), m=pad(dateObj.getMonth()+1), d=pad(dateObj.getDate()), h=pad(dateObj.getHours()), mi=pad(dateObj.getMinutes());
        return `${y}${m}${d}T${h}${mi}00`;
      }
      const uid = `${Date.now()}-${Math.random().toString(36).slice(2)}@sdn2karangmangu`;
      return `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//SDN2Karangmangu//Agenda//ID
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${toLocal(new Date())}
DTSTART:${toLocal(dt)}
DTEND:${toLocal(end)}
SUMMARY:${ev.title}
DESCRIPTION:${ev.desc}
LOCATION:${ev.place}
END:VEVENT
END:VCALENDAR`.replace(/\n/g,"\r\n");
    }
    function renderEvents(){
      list.innerHTML='';
      const m=selMonth.value, t=selType.value;
      events.forEach(ev=>{
        const dt=new Date(ev.date);
        const monthMatch = m==='all' || (dt.getMonth()+1)==Number(m);
        const typeMatch = t==='all' || ev.type===t;
        if(!(monthMatch && typeMatch)) return;
        const el=document.createElement('div'); el.className='events item';
        el.innerHTML=`
          <div class="date-badge"><b>${fmtDate(ev.date,{day:'2-digit'})}</b><small>${fmtDate(ev.date,{month:'short'})}</small></div>
          <div>
            <h4 style="margin:.1rem 0">${ev.title}</h4>
            <div class="lead" style="display:flex;gap:.6rem;flex-wrap:wrap;margin:.2rem 0 .5rem">
              <span class="chip"><i class="fa-regular fa-calendar"></i> ${fmtDate(ev.date,{weekday:'long', day:'2-digit', month:'long', year:'numeric'})}</span>
              <span class="chip"><i class="fa-solid fa-location-dot"></i> ${ev.place}</span>
              <span class="chip"><i class="fa-solid fa-tag"></i> ${ev.type.toUpperCase()}</span>
            </div>
            <p class="lead">${ev.desc}</p>
            <div style="display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.5rem">
              <a class="btn btn-outline" href="#" data-ics="${encodeURIComponent(toICS(ev))}"><i class="fa-regular fa-calendar-plus"></i> Tambah ke Kalender</a>
            </div>
          </div>`;
        list.appendChild(el);
      });
      if(!list.children.length){
        const empty=document.createElement('div');
        empty.className='card';
        empty.textContent='Tidak ada agenda pada filter ini.';
        list.appendChild(empty);
      }
      list.querySelectorAll('[data-ics]')?.forEach(a=>{
        a.addEventListener('click', (e)=>{
          e.preventDefault();
          const ics=a.getAttribute('data-ics');
          const blob=new Blob([decodeURIComponent(ics)], {type:'text/calendar;charset=utf-8'});
          const url=URL.createObjectURL(blob);
          const tmp=document.createElement('a'); tmp.href=url; tmp.download='agenda-sdn2k.ics';
          document.body.appendChild(tmp); tmp.click(); tmp.remove();
          setTimeout(()=>URL.revokeObjectURL(url), 2000);
        });
      });
    }
    function renderAgenda(){
      if(!agendaList) return;
      agendaList.innerHTML='';
      const today=new Date();
      events.filter(e=>new Date(e.date)>=new Date(today.toDateString()))
        .sort((a,b)=>new Date(a.date)-new Date(b.date))
        .slice(0,3)
        .forEach(e=>{
          const el=document.createElement('a'); el.href="#kalender";
          el.innerHTML=`<i class="fa-regular fa-calendar"></i> ${fmtDate(e.date,{day:'2-digit',month:'short'})} — ${e.title}`;
          agendaList.appendChild(el);
        });
    }
    function setLastSync(){
      const d=new Date();
      lastSyncEl.textContent = `Terakhir sinkron: ${d.toLocaleString('id-ID')}`;
    }
    function mapRow(row){
      // Header bebas kapitalisasi: Title, Date, Type, Place, Desc
      const title=row.title||row.Title||row.judul||row.Judul||'(Tanpa Judul)';
      const date =(row.date||row.Date||row.tanggal||row.Tanggal||'').trim();
      const type =(row.type||row.Type||row.jenis||row.Jenis||'kegiatan').toLowerCase();
      const place=(row.place||row.Place||row.lokasi||row.Lokasi||'—');
      const desc =(row.desc||row.Desc||row.deskripsi||row.Deskripsi||'');
      // Validasi tanggal simpel (YYYY-MM-DD)
      if(!/^\d{4}-\d{2}-\d{2}$/.test(date)) return null;
      return {title, date, type, place, desc};
    }
    async function loadFromSheet(){
      if(!SHEET_CSV_URL || SHEET_CSV_URL.includes('KEY')) { alert('Mohon isi SHEET_CSV_URL terlebih dulu.'); return; }
      try{
        const res = await fetch(SHEET_CSV_URL, {cache:'no-store'});
        if(!res.ok) throw new Error('Gagal mengambil CSV dari Google Sheets.');
        const csv = await res.text();
        const parsed = Papa.parse(csv, {header:true, skipEmptyLines:true});
        const rows = (parsed.data||[]).map(mapRow).filter(Boolean);
        if(!rows.length){ alert('CSV kosong atau format kolom tidak cocok. Wajib: title,date,type,place,desc'); return; }
        events = rows.sort((a,b)=>new Date(a.date)-new Date(b.date));
        renderEvents(); renderAgenda(); setLastSync();
      }catch(err){
        console.error(err);
        alert('Tidak bisa sinkron dari Google Sheets.\nPastikan: File → Share → Publish to the web (CSV), link publik.');
      }
    }
    function loadFromFile(file){
      Papa.parse(file, {
        header:true, skipEmptyLines:true,
        complete: results=>{
          const rows=(results.data||[]).map(mapRow).filter(Boolean);
          if(!rows.length){ alert('CSV kosong atau format tidak cocok. Kolom: title,date,type,place,desc'); return; }
          events = rows.sort((a,b)=>new Date(a.date)-new Date(b.date));
          renderEvents(); renderAgenda(); setLastSync();
        },
        error: err=>{ console.error(err); alert('Gagal parsing CSV.'); }
      });
    }
    selMonth?.addEventListener('change',()=>{renderEvents();});
    selType ?.addEventListener('change',()=>{renderEvents();});
    syncBtn?.addEventListener('click', loadFromSheet);
    csvInput?.addEventListener('change', e=>{ const f=e.target.files?.[0]; if(f) loadFromFile(f); });

    renderEvents(); renderAgenda();

    /* ====== THEME TOGGLER ====== */
    const prefKey='sdn2-theme';
    const thLight=document.getElementById('thLight');
    const thDark=document.getElementById('thDark');
    const thSystem=document.getElementById('thSystem');
    function applySystemIfNeeded(){
      const mode=localStorage.getItem(prefKey) || 'system';
      if(mode==='system'){
        const dark=window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.style.colorScheme = dark?'dark':'light';
      }else{ document.documentElement.style.colorScheme = mode; }
    }
    function setTheme(mode){
      document.documentElement.setAttribute('data-theme', mode);
      localStorage.setItem(prefKey, mode);
      [thLight,thDark,thSystem].forEach(btn=>btn.setAttribute('aria-pressed','false'));
      if(mode==='light') thLight.setAttribute('aria-pressed','true');
      else if(mode==='dark') thDark.setAttribute('aria-pressed','true');
      else thSystem.setAttribute('aria-pressed','true');
      applySystemIfNeeded();
    }
    thLight.addEventListener('click',()=>setTheme('light'));
    thDark .addEventListener('click',()=>setTheme('dark'));
    thSystem.addEventListener('click',()=>setTheme('system'));
    const mq = window.matchMedia('(prefers-color-scheme: dark)');
    if (typeof mq.addEventListener === 'function') mq.addEventListener('change', applySystemIfNeeded);
    else if (typeof mq.addListener === 'function') mq.addListener(applySystemIfNeeded);
    setTheme(localStorage.getItem(prefKey)||'system');

    /* ====== SCROLLSPY ====== */
    const sections=['#beranda','#ppdb','#pengumuman','#berita','#kalender','#galeri','#kontak'];
    const links=[...document.querySelectorAll('.menu a')].filter(a=>sections.includes(a.getAttribute('href')));
    const obs=new IntersectionObserver(entries=>{
      entries.forEach(en=>{
        if(en.isIntersecting){
          const id='#'+en.target.id;
          links.forEach(a=>a.setAttribute('aria-current', String(a.getAttribute('href')===id)));
        }
      });
    },{rootMargin:'-40% 0px -55% 0px', threshold:[0,1]});
    sections.forEach(id=>{ const el=document.querySelector(id); if(el) obs.observe(el); });

    /* ====== ACCESSIBILITY ====== */
    document.addEventListener('keydown', e=>{ if(e.key==='Escape') mobileMenu?.classList.add('hidden'); });

    /* ====== PPDB MODAL ====== */
    const ppdbDialog=document.getElementById('ppdbDialog');
    const ppdbFrame =document.getElementById('ppdbFrame');
    const ppdbOpenNew=document.getElementById('ppdbOpenNew');
    function openPPDB(){
      if(!PPDB_FORM_URL || PPDB_FORM_URL.includes('REPLACE_ME')){
        alert('Mohon isi PPDB_FORM_URL terlebih dulu.');
        return;
      }
      ppdbFrame.src = PPDB_FORM_URL;
      ppdbOpenNew.href = PPDB_FORM_URL;
      if (typeof ppdbDialog.showModal === 'function') ppdbDialog.showModal();
      else window.open(PPDB_FORM_URL, '_blank'); // fallback jika browser tidak dukung <dialog>
    }
    document.getElementById('openPPDB')?.addEventListener('click',openPPDB);
    document.getElementById('openPPDB2')?.addEventListener('click',openPPDB);
    document.getElementById('ppdbClose')?.addEventListener('click',()=>ppdbDialog.close());
  </script>
  <script>
/* ==== Helper: hormati preferensi Reduce Motion ==== */
function prefersReduceMotion(){ return window.matchMedia('(prefers-reduced-motion: reduce)').matches; }

/* ==== HERO slider: pause saat off-screen & hormati reduce-motion ==== */
(function(){
  const track = document.getElementById('heroCarousel');
  if(!track) return;

  const dots = document.getElementById('heroDots');
  const prev = document.getElementById('heroPrev');
  const next = document.getElementById('heroNext');
  const slides = Array.from(track.children);

  let idx=0, timer=null, visible=true;

  function renderDots(){
    if(!dots) return;
    dots.innerHTML='';
    slides.forEach((_,i)=>{
      const b=document.createElement('button');
      b.type='button'; b.setAttribute('aria-label','Ke slide '+(i+1));
      b.addEventListener('click',()=>go(i));
      dots.appendChild(b);
    });
  }
  function update(){
    track.style.transform = `translateX(-${idx*100}%)`;
    if(dots) [...dots.children].forEach((d,i)=>d.setAttribute('aria-current', String(i===idx)));
  }
  function go(i){ idx = (i+slides.length)%slides.length; update(); }
  function step(){ go(idx+1); }

  function start(){
    stop();
    if (prefersReduceMotion() || !visible) return; // jangan autoplay
    timer = setInterval(step, 5000);
  }
  function stop(){ if(timer){ clearInterval(timer); timer=null; } }

  prev?.addEventListener('click',()=>go(idx-1));
  next?.addEventListener('click',()=>go(idx+1));
  track.addEventListener('mouseenter', stop);
  track.addEventListener('mouseleave', start);
  document.addEventListener('visibilitychange', ()=>{ document.hidden ? stop() : start(); });

  // Pause saat tidak terlihat
  const io = new IntersectionObserver(([en])=>{ visible = en.isIntersecting; visible ? start() : stop(); }, {threshold: 0.3});
  io.observe(track.parentElement); // observe kontainer media-hero

  renderDots(); update(); start();
})();

/* ==== Galeri Atas: autoplay aman (tidak menggulung halaman) ==== */
/* kalau kamu SUDAH pakai versi “aman” sebelumnya, lewati blok ini */
(function(){
  const track = document.getElementById('hgallery');
  if(!track) return;
  const items = Array.from(track.children);
  if(!items.length) return;

  let idx=0, timer=null, visible=true;

  function centerTo(el){
    const r = track.getBoundingClientRect(), i = el.getBoundingClientRect();
    const delta = (i.left - r.left) - (r.width/2 - i.width/2);
    track.scrollBy({ left: delta, behavior: 'smooth' });
  }
  function go(i){ idx = (i%items.length + items.length) % items.length; centerTo(items[idx]); }
  function step(){ go(idx+1); }
  function start(){ stop(); if (prefersReduceMotion() || !visible) return; timer = setInterval(step, 5000); }
  function stop(){ if(timer){ clearInterval(timer); timer=null; } }

  track.addEventListener('mouseenter', stop);
  track.addEventListener('mouseleave', start);
  track.addEventListener('touchstart', stop, {passive:true});
  track.addEventListener('touchend', start, {passive:true});
  document.addEventListener('visibilitychange', ()=>{ document.hidden ? stop() : start(); });

  const io = new IntersectionObserver(([en])=>{ visible = en.isIntersecting; visible ? start() : stop(); }, {threshold: 0.15});
  io.observe(track);

  go(0); start();
  window.addEventListener('resize', ()=>centerTo(items[idx]));
})();

/* ==== TEACHERS & GALERI SEKOLAH: tambahkan guard reduce-motion + IO ==== */
(function(){
  // Teachers
  const track = document.getElementById('teacherTrack');
  if(track){
    const cards = Array.from(track.children); if(cards.length){
      let idx=0, dir=1, t=null, visible=true;
      function center(el){ const x=el.offsetLeft-(track.clientWidth-el.clientWidth)/2; track.scrollTo({left:Math.max(0,x),behavior:'smooth'}); }
      function go(i){ idx=(i%cards.length+cards.length)%cards.length; center(cards[idx]); }
      function step(){ if(idx===cards.length-1) dir=-1; else if(idx===0) dir=1; go(idx+dir); }
      function start(){ stop(); if (prefersReduceMotion() || !visible) return; t=setInterval(step,5000); }
      function stop(){ if(t){ clearInterval(t); t=null; } }
      track.addEventListener('mouseenter',stop);
      track.addEventListener('mouseleave',start);
      track.addEventListener('touchstart',stop,{passive:true});
      track.addEventListener('touchend',start,{passive:true});
      document.addEventListener('visibilitychange',()=>{document.hidden?stop():start();});
      window.addEventListener('resize',()=>center(cards[idx]));

      const io=new IntersectionObserver(([en])=>{visible=en.isIntersecting; visible?start():stop();},{threshold:.2});
      io.observe(track);

      go(0); start();
    }
  }

  // Galeri Sekolah
  const rail = document.getElementById('galleryRail');
  const dots = document.getElementById('gDots');
  const prev = document.getElementById('gPrev');
  const next = document.getElementById('gNext');
  if(rail){
    const items = Array.from(rail.children);
    if(items.length){
      let idx=0, dir=1, t=null, visible=true;
      function center(el){ const R=rail.getBoundingClientRect(), I=el.getBoundingClientRect(); const delta=(I.left-R.left)-(R.width/2-I.width/2); rail.scrollBy({left:delta,behavior:'smooth'}); }
      function go(i){ idx=(i%items.length+items.length)%items.length; center(items[idx]); updateDots(); }
      function step(){ if(idx===items.length-1) dir=-1; else if(idx===0) dir=1; go(idx+dir); }
      function start(){ stop(); if (prefersReduceMotion() || !visible) return; t=setInterval(step,5000); }
      function stop(){ if(t){ clearInterval(t); t=null; } }
      function updateDots(){ if(!dots) return; [...dots.children].forEach((d,i)=>d.setAttribute('aria-current', String(i===idx))); }
      function renderDots(){ if(!dots) return; dots.innerHTML=''; items.forEach((_,i)=>{const b=document.createElement('button'); b.type='button'; b.setAttribute('aria-label','Ke item '+(i+1)); b.addEventListener('click',()=>go(i)); dots.appendChild(b);}); }

      prev?.addEventListener('click',()=>{dir=-1; step();});
      next?.addEventListener('click',()=>{dir= 1; step();});
      rail.addEventListener('mouseenter',stop);
      rail.addEventListener('mouseleave',start);
      rail.addEventListener('touchstart',stop,{passive:true});
      rail.addEventListener('touchend',start,{passive:true});
      document.addEventListener('visibilitychange',()=>{document.hidden?stop():start();});
      window.addEventListener('resize',()=>center(items[idx]));

      const io=new IntersectionObserver(([en])=>{visible=en.isIntersecting; visible?start():stop();},{threshold:.15});
      io.observe(rail);

      renderDots(); go(0); start();
    }
  }
})();

/* ==== Cegah link dummy '#' menggeser ke atas ==== */
document.querySelectorAll('a[href="#"]').forEach(a=>{
  a.addEventListener('click', e => e.preventDefault());
});
</script>

</body>
</html>
